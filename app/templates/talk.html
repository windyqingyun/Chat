{% extends 'layout.html' %}

{% block page_content %}
<div class="talkContent">
    <div class="row" style="padding-left:15px;border: 3px solid #ccc;height: 24.5%;">
        <div  style="overflow-y: auto;height: 100%">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>访客姓名</th>
                        <th>IP</th>
                        <th>访问次数</th>
                        <th>访问时间</th>
                        <th>下单次数</th>
                        <th>上次接待</th>
                        <th>当前接待</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody class="guestList">
                </tbody>
            </table>
        </div>
    </div>
    <div class="row" style="height: 75%;">
        <div class="talk-left" style="padding-left:15px;float:left;width: 20%;height:100%;min-height:242px;border: 1px solid #ccc">
            <ul id="leftTab" class="nav nav-tabs">
                <li class="active" style="width: 50%"><a href="#talkList" data-toggle="tab">对话列表</a></li>
                <li style="width: 50%"><a href="#kfList" data-toggle="tab">客服</a></li>
            </ul>
            <div id="leftTabContent" class="tab-content">
                <div class="tab-pane fade in active" id="talkList">
                    <ul class="chat-user-list">

                        <li class="active">
                            <a href="#">
                              <span>暂无任何用户</span>
                             </a>
                        </li>

                    </ul>
                </div>
                <div class="tab-pane fade" id="kfList">
                    <p>iOS 是一个由苹果公司开发和发布的手机操作系统。最初是于 2007 年首次发布 iPhone、iPod Touch 和 Apple
                        TV。iOS 派生自 OS X，它们共享 Darwin 基础。OS X 操作系统是用在苹果电脑上，iOS 是苹果的移动版本。</p>
                </div>
            </div>
        </div>



        <div class="talk-content" style="float:left;width: 50%;height:100%;border: 1px solid #ccc">

            <div  style="height: 6%;text-align:center;padding-top: 10px;">张三</div>
            <div  style="height: 94%;">
                <div class="showContent" style="height: 75%;min-height:150px;overflow-y:auto;border: 1px solid #ccc">
                    <ul class="chat-msg" style="padding: 0px;">
                    </ul>
                </div>
                <div class="tools" style="height: 5%;border: 1px solid #ccc">
                </div>
                <div class="writeContent" style="height: 20%;min-height:50px;border: 1px solid #ccc">
                    <textarea  rows="5" placeholder="按Enter键发送信息" id="inputContent" style="width: 100%;height:100%;resize: none;border-style: none">

                    </textarea>
                </div>
            </div>

        </div>

        <div class="talk-right" style="float:left;width: 29%;height:100%;min-height:242px;border: 1px solid #ccc;overflow-y: auto">
             <ul id="rightTab" class="nav nav-tabs">
                <li class="active" style="width: 50%"><a href="#common" data-toggle="tab">常用语</a></li>
                <li style="width: 50%" ><a href="#record"  data-toggle="tab">聊天记录</a></li>
            </ul>
            <div id="rightTabContent" class="tab-content">
                <div class="tab-pane fade in active" id="common">
                    <div id="tree"></div>

                    <div class="row" style="position: absolute;bottom: 2px; "  >
                        <div class="col-md-3">
                            <div class="dropup">
                                    <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">
                                        <i class="fa fa-plus"></i>添加<b class="caret"></b>
                                    </button>
                                    <ul class="dropdown-menu" style="border: 1px solid #ccc">
                                         <li style="text-align: center"><a href="#" data-toggle="modal" data-target="#addCommonLanguageGroupModal">常用语组</a></li>
                                         <li style="text-align: center"><a href="#" data-toggle="modal" data-target="#addCommonLanguageModal">常用语</a></li>
                                    </ul>
                                </div>
                        </div>
                         <div class="col-md-3">
                             <a type="button" class="btn btn-default"><i class="fa fa-edit"></i>修改</a>
                         </div>
                         <div class="col-md-3">
                             <a type="button" class="btn btn-default"><i class="fa fa-remove"></i>删除</a>
                         </div>
                         <div class="col-md-3">
                             <a type="button" class="btn btn-default"><i class="fa fa-refresh"></i>刷新</a>
                         </div>

                    </div>
                </div>
                <div class="tab-pane fade" id="record">
                    <p>聊天记录</p>
                </div>
            </div>
        </div>

    </div>
</div>



<!-- 常用语组 增加/修改 （Modal） -->
<div class="modal fade" id="addCommonLanguageGroupModal" tabindex="-1" role="dialog" aria-labelledby="commonLanguageGroupModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="commonLanguageGroupModalLabel">
					添加常用语组
				</h4>
			</div>
			<div class="modal-body">
				<div class="input-group">
                    <span class="input-group-addon">名称</span>
                    <input type="text" class="form-control" placeholder="名称">
                </div>
                <div class="input-group">
                    <span class="input-group-addon">描述</span>
                    <input type="text" class="form-control" placeholder="描述">
                </div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="button" class="btn btn-primary">提交更改</button>
			</div>
		</div>
	</div>
</div>
<!-- 常用语组 增加/修改 （Modal）END -->


<!-- 常用语 增加/修改 （Modal） -->
<div class="modal fade" id="addCommonLanguageModal" tabindex="-1" role="dialog" aria-labelledby="commonLanguageModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="commonLanguageModalLabel">
					添加常用语
				</h4>
			</div>
			<div class="modal-body">

                <div class="dropdown">
                    <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">默认分组
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" href="#">自定义1</a>
                        </li>
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" href="#">自定义2</a>
                        </li>
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" href="#">自定义3</a>
                        </li>
                    </ul>
                </div>

				<div class="input-group">
                    <span class="input-group-addon">名称</span>
                    <input type="text" class="form-control" placeholder="名称">
                </div>
                <div class="input-group">
                    <span class="input-group-addon">显示内容</span>
                    <input type="text" class="form-control" placeholder="显示内容">
                </div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="button" class="btn btn-primary">提交更改</button>
			</div>
		</div>
	</div>
</div>
<!-- 常用语 增加/修改 （Modal） END -->

{#<script src="{{ url_for('static',filename='jquery/dist/jquery.min.js') }}"></script>#}
<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="{{ url_for('static',filename='js/talk.js') }}"></script>
<script src="{{ url_for('static',filename='bootstrap-treeview/dist/bootstrap-treeview.min.js') }}"></script>

<script>
    //获取窗口高度 并设置内容界面高度
    bodyHeight = $(document.body).height()
    $('.talkContent').css('height',bodyHeight-50)

    //内容输入初始化
    $('#inputContent').val('')

    //左标签页
    $('#leftTab a').click(function (e) {
        e.preventDefault()
        $(this).tab('show')
    });
    //右标签页
    $('#rightTab a').click(function (e) {
         e.preventDefault()
         $(this).tab('show')
    });

    //开启回复轮询
    //  startGetReplyTask('{{ kf.id }}')

     //获取常用语树内容
     function getTree() {
         var treeContent ;
         //同步加载
         $.ajax({
            url : '{{ url_for('static',filename='js/tree.json') }}',
            type : "GET",
            async: false,
            dataType:'json',
            success : function (result){
                treeContent = result.tree;
            }
          });
         return treeContent;
    }

    $('#tree').treeview({data: getTree()});
    $('#tree').on('nodeSelected', function(event, node) {
        if(node.value != undefined){
            $('#inputContent').val(node.value);
            $('#inputContent').focus()
        }
    });

     //获取最新访客消息
     $.ajax({
            url : '{{ url_for('static',filename='js/msg.json') }}',
            type : "GET",
            dataType:'json',
            success : function (result){
                  $.each( result.msg, function(index, o)
                  {
                      _html = '<tr>                               \
                                    <td>'+o.name+'</td>           \
                                    <td>'+o.ip+'</td>             \
                                    <td>'+o.accessCount+'</td>    \
                                    <td>'+o.accessTime+'</td>     \
                                    <td>'+o.orderCount+'</td>     \
                                    <td>'+o.lastAccept+'</td>     \
                                    <td>'+o.currentAccept+'</td>  \
                                    <td>正在通话</td>               \
                                 </tr>'
                    $('.guestList').append(_html)
                  });

            }
     });

    $('#inputContent').bind('keyup', function(event) {
        if (event.ctrlKey && event.keyCode == 13) {
            event.preventDefault();
            content = $('#inputContent').val()+'\n'
            $('#inputContent').val(content)
        }else if (event.keyCode == 13){
            event.preventDefault();
            send('{{ kf.id }}','{{ kf.name }}')
        }
    });


</script>

{% endblock %}